<!DOCTYPE html>
<html lang="en">
<head>
    <title>New collections in JS: Map, Set, WeakMap, WeakSet</title>

    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Shower Theme -->
    <link rel="stylesheet" href="https://npmcdn.com/shower-ribbon/styles/screen-16x10.css">
    <link rel="stylesheet" href="vendors/shower-warsawjs/styles/main.css"/>
    <link rel="stylesheet" href="modules/custom-shower.css">

    <!-- Prism.js -->
    <link rel="stylesheet" href="vendors/prism/prism.css">
    <link rel="stylesheet" href="modules/custom-prism.css">

    <!-- My own beautiful photos as backgrounds -->
    <link rel="stylesheet" href="modules/photos.css">
    <link rel="stylesheet" href="modules/overlay-bars.css">
    <link rel="stylesheet" href="modules/birthday.css">
    <link rel="stylesheet" href="modules/a-lot-stuff.css">
    <link rel="stylesheet" href="modules/fullscreen-picture.css">
    <link rel="stylesheet" href="modules/tiny-text.css">
    <link rel="stylesheet" href="modules/cover-helper.css">
</head>
<body class="shower list">
    <header class="caption">
        <h1>New collections in JS: Map, Set, WeakMap, WeakSet</h1>
        <p>Piotr Kowalski @piecioshka</p>
    </header>

    <section class="slide birthday">
        <h2 class="shout grow">
            <span class="years">2</span><sup>nd</sup>
            <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;birthday&#x1F382;</span>
        </h2>
    </section>

    <section class="slide front-page">
        <div class="logo">
            <!-- Logo WarsawJS -->
            <img src="pictures/logo/warsawjs-logo-light.png">
        </div>

        <div class="details">
            <!-- 1. Avatar -->
            <img src="pictures/my-avatar.jpg" alt="Speaker"/>

            <!-- 2. Speaker -->
            <h2>Piotr Kowalski</h2>

            <!-- 3. Presentation title -->
            <h2>
                <strong>"New collections in JS: Map, Set, WeakMap, WeakSet"</strong>
            </h2>

            <!-- 4. Presentation date -->
            <h2>2016-09-14</h2>

            <!-- 5. Contact the speaker -->
            <h2><a href="http://twitter.com/piecioshka">@piecioshka</a></h2>
        </div>

        <div class="next slides-short-url as-overlay">
            <a href="http://bit.ly/2crnPjJ">bit.ly/2crnPjJ</a>
        </div>
    </section>

    <section class="slide" itemscope itemtype="http://schema.org/Person">
        <div class="who-am-i">
            <h2>Who am I?</h2>
            <h3><mark>Piotr Kowalski</mark></h3>

            <h3 itemprop="jobTitle">Kierownik Działu Aplikacji Webowych</h3>

            <p itemscope itemtype="https://schema.org/Organization">
                <span itemprop="name">Cyfrowy Polsat</span>,
                <span itemprop="location">Warsaw</span>
            </p>

            <p>
                <span><a href="http://www.refsnesdata.no/certification/w3certified.asp?id=4931932">JavaScript Ninja</a>. Mac lover. Open source fan.</span>
                <span><a href="https://piecioshka.pl/blog/">Blogger</a>.</span><br/>
                <span>Organizer <a href="http://warsawjs.com/" itemprop="memberOf">WarsawJS</a>.</span>
                <span>Author of several libs in <a href="https://www.npmjs.com/~piecioshka">@npm</a></span>
            </p>

            <p class="note">"Kto chce szuka sposobu, kto nie chce szuka powodu."</p>
        </div>

        <div class="next twitter-username as-overlay">
            <a href="http://twitter.com/piecioshka">@piecioshka</a>
        </div>
    </section>

    <section class="slide prism">
        <h2>Can you explain what happen here?</h2>

        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
                var MAP = {};
                var foo = { name: 'foo' };
                var bar = { name: 'bar' };

                MAP[foo] = "Hello";
                MAP[bar] = "World";

                console.log(MAP[foo]); // ???
            </code>
        </pre>

        <p class="note">My interview question.</p>
    </section>

    <section class="slide prism">
        <h2>I &#x2764; Map</h2>

        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
                var MAP = new Map();
                var foo = { name: 'foo' };
                var bar = { name: 'bar' };

                MAP.set(foo, "Hello");
                MAP.set(bar, "World");

                console.log(MAP.get(foo)); // ???
            </code>
        </pre>
    </section>

    <section class="slide">
        <h2 class="shout">What collections<br/>have we got&#x2049;&#xFE0F;</h2>
    </section>

    <section class="slide compact a-lot-stuff">
        <h2>Ignore this list of native collections</h2>

        <p>
            SIMD:
            <code>
                Float32Array,
                Float64Array,
                Int8Array,
                Int16Array,
                Int32Array,
                Uint8Array,
                Uint8ClampedArray,
                Uint16Array,
                Uint32Array
            </code>
        </p>

        <p>
            DOM:
            <code>
                DOMStringList,
                DOMStringMap,
                DOMTokenList,
                HTMLCollection,
                HTMLAllCollection,
                HTMLFormControlsCollection,
                HTMLOptionsCollection,
                NodeList,
                RadioNodeList,
                SVGAnimatedLengthList,
                SVGAnimatedNumberList,
                SVGAnimatedTransformList,
                SVGLengthList,
                SVGNumberList,
                SVGPointList,
                SVGStringList,
                SVGTransformList
            </code>
        </p>

        <p>
            Misc:
            <code>
                ArrayBuffer
                AudioTrackList,
                CSSRuleList,
                ClientRectList,
                DataTransferItemList,
                FileList,
                MediaKeys,
                MediaList,
                MediaQueryList,
                MimeTypeArray,
                PluginArray,
                SourceBufferList,
                SpeechGrammarList,
                StylePropertyMap,
                StyleSheetList,
                TextTrackCueList,
                TextTrackList,
                TouchList,
                TrackDefaultList,
                VTTRegionList,
                VideoTrackList
            </code>
        </p>
    </section>

    <section class="slide photo photo-7">
        <h2 class="shout"><code>Object</code><br/>(well known)</h2>
    </section>

    <section class="slide photo photo-5">
        <h2 class="shout"><code>Array</code><br/>(well known)</h2>
    </section>

    <section class="slide photo photo-12">
        <h2 class="shout">&#x2728; <code>Map</code> &#x2728;</h2>
    </section>

    <section class="slide photo photo-9">
        <h2 class="shout">&#x2728; <code>Set</code> &#x2728;</h2>
    </section>

    <section class="slide photo photo-10">
        <h2 class="shout"><code>WeakMap</code> &#x2728;</h2>
    </section>

    <section class="slide photo photo-3">
        <h2 class="shout"><code>WeakSet</code> &#x2728;</h2>
    </section>

    <section class="slide compact">
        <h2>Desktop browsers support</h2>

        <table class="striped" style="font-size: 40px">
            <tr>
                <th scope="col" width="100">...</th>
                <th width="150">Map</th>
                <th width="150">Set</th>
                <th width="150">WeakMap</th>
                <th width="150">WeakSet</th>
            </tr>
            <tr>
                <th scope="row">Chrome</th>
                <td>38</td>
                <td>38</td>
                <td>36 <small class="tiny-text">2014-07</small></td>
                <td>36</td>
            </tr>
            <tr>
                <th scope="row">Firefox</th>
                <td>13</td>
                <td>13</td>
                <td>6</td>
                <td>34</td>
            </tr>
            <tr>
                <th scope="row">IE</th>
                <td>11</td>
                <td>11</td>
                <td>11</td>
                <td><pre style="margin: 0"><mark class="important">x</mark></pre></td>
            </tr>
            <tr>
                <th scope="row">Opera</th>
                <td>25</td>
                <td>25</td>
                <td>23</td>
                <td>23</td>
            </tr>
            <tr>
                <th scope="row">Safari</th>
                <td>7.1</td>
                <td>7.1</td>
                <td>7.1</td>
                <td>9</td>
            </tr>
        </table>
    </section>

    <section class="slide">
        <h2 class="shout">Which collection is the best&#x2049;&#xFE0F;</h2>
    </section>

    <section class="slide">
        <h2 class="shout">No one.</h2>
    </section>

    <section class="slide photo photo-12">
        <h2 class="shout"><code>Map</code></h2>
        <p class="note">
            The Map object is a simple key/value map. Any value (both objects and primitive values) may be used as either a key or a value.
            <strong>MDN @ 2016</strong>
        </p>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
                // #1: API: Hashmap
                // --------------------------------------------------
                var map = new Map();

                map.set('foo', 'bar')
                // instead of: object[key] = value

                map.size // 1
                // instead of: array.length

                map.get('foo') // 'bar'
                 // instead of: object[key]
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
                // #2: API
                // --------------------------------------------------

                // Remove pair key/value (by reference or primitive)
                map.delete(key) // instead of: array.splice(0, 1)

                // Clear collection
                map.clear() // instead of: array.length = 0
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
                // #3: API
                // --------------------------------------------------

                // Check if key is used in collection
                map.has(key)

                // instead of:
                object.hasOwnProperty(key) // or: key in object
                array.indexOf(value) !== -1
                array.includes(value) // ES2016 (a.ka. ES7) way
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
                // #4: API: Magic
                // --------------------------------------------------
                // Get pair key/value form collection {MapIterator}
                map.entries() // similar to: Object.entries(object)

                // Get keys from collection {MapIterator}
                map.keys() // similar to: Object.keys(object)

                // Get values from collection {MapIterator}
                map.values() // similar to: Object.values(object)
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
                // #5: API: Simple iteration
                // --------------------------------------------------

                // Iteration through collection
                map.forEach((value, key) => /* ... */)
                // the same in arrays

                // New loop for..of
                for (var [key, value] of map.entries()) {
                    map.delete(key) // true
                }
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
                // #6: API: WTF?
                // --------------------------------------------------
                var map = new Map()
                map.set() // Map { undefined => undefined }
                map.size // 1

                // In arrays
                var array = []
                array.push()
                array.length // 0
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
                // #7: API: "Holy" couple key/value
                // --------------------------------------------------
                var map = new Map();
                var rand = Math.random();

                map.set([1, 2, 3], Math.random())
                map.set([1, 2, 3], Math.random())
                map.set([1, 2, 3], rand)
                map.set([1, 2, 3], rand)

                map.size // 4
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
                // #8: API: .. but unique key!
                // --------------------------------------------------
                var map = new Map();
                var rand = Math.random();

                map.set('item', Math.random())
                map.set('item', rand) // overwrite previous

                map.size // 1

                map // Map {"item" => 0.199...}
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 26px;" class="language-javascript line-numbers">
            <code>
                // #1: Example: Array as key
                // --------------------------------------------------
                var map = new Map()
                map.set(['win8', 'moz'], 'a').set(['xp', 'chrome'], 'b')

                function check(collection, ...browsers) {
                    for (let [key, value] of collection)
                        // "xp,firefox" === "win8,moz"
                        if (String(browsers) === String(key))
                            return value
                }
                check(map, 'xp', 'firefox') // 'b'
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 25px;" class="language-javascript line-numbers">
            <code>
                // #2: Example: Async iteration
                // --------------------------------------------------
                map.set({ foo: 1 }, 'a').set({ foo: 2 }, 'b')
                var iterator = map.values() // {MapIterator}
                var interval = setInterval(() => {
                    let item = iterator.next()
                    if (item.done) {
                        clearInterval(interval)
                        return
                    }
                    console.log(item.value) // 'a' => [ONE SECOND] => 'b'
                }, 1000)
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 25px;" class="language-javascript line-numbers">
            <code>
                // #3: Example: Subclassing of Map
                // --------------------------------------------------
                class MultiMap extends Map {
                    set(...args) {
                        args.map(([key, value]) => super.set(key, value));
                        return this;
                    }
                }
                var map = new MultiMap();
                map.set(['key', 'value'], ['key2', 'value2']);
                // Map {"key" => "value", "key2" => "value2"}
            </code>
        </pre>
    </section>

    <section class="slide">
        <h2 class="shout">So, why <code>Map</code> is cool&#x2049;&#xFE0F;</h2>
    </section>

    <section class="slide photo photo-9">
        <h2 class="shout"><code>Set</code></h2>
        <p class="note">
            The Set object lets you store unique values of any type, whether primitive values or object references.
            <strong>MDN @ 2016</strong>
        </p>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
                // #2: API
                // --------------------------------------------------
                var set = new Set([1, 2, 3, 4])

                set.add(value) // instead of: array.push(value)
                // NOT: set.set() // ??? undefined

                // Removing is by value (or reference), not index.
                set.delete(3) // true
                set.clear() // ...and we have empty Set
                set.has(value) // Check by reference
                set.get(key) // TypeError: set.get is not a function
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
                // #3: API: Magic
                // --------------------------------------------------
                // Get values from collection {SetIterator}
                set.entries()
                set.keys()
                set.values()

                // hmmm...
                // set.values() and set.keys() returns same Iterator
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
                // #6: API: Simple iteration
                // --------------------------------------------------
                var set = new Set([1, 1, 2])

                set.forEach((item) => {
                    console.log(item) // 1, 2
                })
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
                // #8: API: Adding without coercing
                // --------------------------------------------------

                let set = new Set();

                set.add(5);
                set.add("5");

                console.log(set.size); // 2
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px; line-height: 30px" class="language-javascript line-numbers">
            <code>
                // #1: Example: AssetsLoader: loadImage helper
                // --------------------------------------------------
                function loadImage(path /* string */) {
                    return new Promise((resolve, reject) => {
                        let image = new Image();
                        let on = image.addEventListener;

                        on('load', () => resolve(image));
                        on('error', () => reject(image));
                        image.src = path;
                    })
                }
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px; line-height: 30px" class="language-javascript line-numbers">
            <code>
                // #1: Example: AssetsLoader: test case
                // --------------------------------------------------
                var al = new AssetsLoader();
                al.addImage('../assets/images/plants.jpg');
                al.addImage('../assets/images/sky.jpg');
                al.loadImages()
                    .catch((error) => {
                        console.error(error);
                    })
                    .then((images) => {
                        console.info('Loaded successful', images);
                    });
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px; line-height: 30px" class="language-javascript line-numbers">
            <code>
                // #1: Example: AssetsLoader v1
                // --------------------------------------------------
                class AssetsLoader {
                    constructor() {
                        this._images = new Set();
                    }
                    addImage(path /* string */) {
                        return this._images.add(loadImage(path));
                    }
                    loadImages() {
                        return Promise.all(this._images);
                    }
                }
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px; line-height: 30px" class="language-javascript line-numbers">
            <code>
                // #2: Example: AssetsLoader v2: Subclassing Set
                // --------------------------------------------------
                class AssetsLoader {
                    constructor() {
                        this._images = new Images();
                    }
                    addImage(path /* string */) {
                        return this._images.add(path);
                    }
                    loadImages() {
                        return this._images.load();
                    }
                }
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px; line-height: 30px" class="language-javascript line-numbers">
            <code>
                // #2: Example: AssetsLoader v2: Subclassing Set
                // --------------------------------------------------
                class Images extends Set {
                    add(path) {
                        return super.add(loadImage(path));
                    }
                    load() {
                        return Promise.all(this.keys());
                    }
                }
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
                // #3: Example: Remove duplicated item (Array)
                // --------------------------------------------------
                var array = [1, 2, 3, 1, 3]

                // Constructor expects another collection
                [...new Set(array)] // [1, 2, 3]
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
                // #3: Example: Remove duplicated items (Map)
                // --------------------------------------------------
                var map = new Map()
                map.set({ foo: 1 }, 'a').set({ foo: 2 }, 'b')

                [...new Set(map.keys())]
                // [{ foo: 1 }, { foo: 2 }]

                [...new Set(map.values())]
                // ['a', 'b']
            </code>
        </pre>
    </section>

    <section class="slide">
        <h2 class="shout">So, why <code>Set</code> is cool&#x2049;&#xFE0F;</h2>
    </section>

    <section class="slide photo photo-10">
        <h2 class="shout"><code>WeakMap</code></h2>
        <p class="note">
            The WeakMap object is a collection of key/value pairs in which the keys are weakly referenced. The keys must be objects and the values can be arbitrary values.
            <strong>MDN @ 2016</strong>
        </p>
    </section>

    <section class="slide prism">
        <pre style="font-size: 28px;" class="language-javascript line-numbers">
            <code>
                // #1: API: Simple API
                // --------------------------------------------------
                var weakMap = new WeakMap()
                var key = { foo: 1 }

                weakMap.set([1], 5) // WeakMap { [1] => 5 }
                weakMap.set(key, 6) // WeakMap { [1] => 5, {foo: 1} => 6 }

                weakMap.get(key) // 6
                weakMap.has(key) // true
                weakMap.delete(key) // true
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
                // #2: API: "Holy" couple key/value
                // --------------------------------------------------
                var weakMap = new WeakMap()

                weakMap.set([1, 2], Math.random())
                weakMap.set([1, 2], Math.random())
                weakMap.set([1, 2], Math.random())

                weakMap.size // ??? undefined

                weakMap // WeakMap {[1, 2] => 0.609..., [1, 2] => 0.268..., [1, 2] => 0.183...}
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
                // #3: API: How it works?
                // --------------------------------------------------
                var users = [{ name: 'Peter' }, { name: 'Kate' }];
                var weakMap = new WeakMap();

                weakMap.set(users[0], 'some info 1');
                weakMap.set(users[1], 'some info 2');

                console.log(weakMap.get(users[0])); // 'some info 1'
                users.splice(0, 1);
                console.log(weakMap.get(users[0])); // 'some info 2'
            </code>
        </pre>
    </section>

    <section class="slide">
        <img class="cover fullscreen-picture" src="pictures/weakmap/logs.png" alt="">
    </section>

    <section class="slide">
        <p class="above-cover">&#x261F;&#xFE0E; 2016-09-12 11:38:59.558 &#x261F;&#xFE0E;</p>
        <img class="cover fullscreen-picture" src="pictures/weakmap/gc-activate-log.png" alt="">
        <p class="below-cover">&#x261D;&#xFE0E; 2016-09-12 11:38:59.656 &#x261D;&#xFE0E;</p>
    </section>

    <section class="slide">
        <img class="cover fullscreen-picture" src="pictures/weakmap/gc-activate-timeline.png" alt="">
    </section>

    <section class="slide compact">
        <h2>More examples of using WeakMap</h2>

        <ul>
            <li>StackOverflow: Link DOM element with any attributes</li>
            <li>Book ExploringJS: Cache:<br/><a href="http://exploringjs.com/es6/ch_maps-sets.html#_caching-computed-results-via-weakmaps">http://exploringjs.com/es6/ch_maps-sets.html#_caching-computed-results-via-weakmaps</a></li>
            <li>Book ExploringJS: Observer pattern:<br/><a href="http://exploringjs.com/es6/ch_maps-sets.html#_managing-listeners">http://exploringjs.com/es6/ch_maps-sets.html#_managing-listeners</a></li>
            <li>Book ExploringJS: Keep private data:<br/><a href="http://exploringjs.com/es6/ch_maps-sets.html#_keeping-private-data-via-weakmaps">http://exploringjs.com/es6/ch_maps-sets.html#_keeping-private-data-via-weakmaps</a></li>
        </ul>
    </section>

    <section class="slide">
        <h2 class="shout">So, why <code>WeakMap</code> is cool&#x2049;&#xFE0F;</h2>
    </section>

    <section class="slide photo photo-3">
        <h2 class="shout"><code>WeakSet</code></h2>
        <p class="note">
            The WeakSet object lets you store weakly held objects in a collection. <strong>MDN @ 2016</strong>
        </p>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
                // #1: API: Simple API
                // --------------------------------------------------
                var weakSet = new WeakSet();

                // Adding ONLY objects
                weakSet.add([1])
                weakSet.add(1)
                // TypeError: Invalid value used in weak set

                // ... by reference (not value)
                weakSet.has([1]) // false
                weakSet.delete([1]) // false
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 21px;" class="language-javascript line-numbers">
            <code>
                // #2: API: How it works?
                // --------------------------------------------------
                var users = [{ name: 'Peter' }, { name: 'Kate' }];
                var weakSet = new WeakSet();

                weakSet.add(users[0]);
                weakSet.add(users[1]);

                console.log(weakSet) // WeakSet {Object {name: "Kate"}, Object {name: "Peter"}}
                users.splice(0, 1);
                console.log(weakSet) // WeakSet {Object {name: "Kate"}, Object {name: "Peter"}}
            </code>
        </pre>
    </section>

    <section class="slide">
        <img class="cover fullscreen-picture" src="pictures/weakset/logs.png" alt="">
    </section>

    <section class="slide">
        <p class="above-cover">&#x261F;&#xFE0E; 2016-09-12 15:13:17.336 &#x261F;&#xFE0E;</p>
        <img class="cover fullscreen-picture" src="pictures/weakset/gc-activate-log.png" alt="">
        <p class="below-cover">&#x261D;&#xFE0E; 2016-09-12 15:13:17.837 &#x261D;&#xFE0E;</p>
    </section>

    <section class="slide">
        <img class="cover fullscreen-picture" src="pictures/weakset/gc-activate-timeline.png" alt="">
    </section>

    <section class="slide compact">
        <h2>More examples of using WeakSet</h2>

        <ul>
            <li>TC39 (Domenic Denicola) Branding:<br/><a href="https://esdiscuss.org/topic/actual-weakset-use-cases">https://esdiscuss.org/topic/actual-weakset-use-cases</a></li>
        </ul>
    </section>

    <section class="slide">
        <h2 class="shout">So, why <code>WeakSet</code> is cool&#x2049;&#xFE0F;</h2>
    </section>

    <section class="slide compact">
        <h2>Benchmark: <mark>Object is fastest</mark></h2>

        <table class="striped" style="font-size: 33px">
            <tr>
                <th>Type</th>
                <th>Operations / seconds</th>
            </tr>
            <tr>
                <td>Object</td>
                <td><code>2,590,044</code> ops/sec ±6.32% (72 runs sampled)</td>
            </tr>
            <tr>
                <td>Array</td>
                <td><code>675,882</code> ops/sec ±13.49% (65 runs sampled)</td>
            </tr>
            <tr>
                <td>Map</td>
                <td><code>152,399</code> ops/sec ±9.67% (63 runs sampled)</td>
            </tr>
            <tr>
                <td>Set</td>
                <td><code>184,469</code> ops/sec ±6.27% (78 runs sampled)</td>
            </tr>
            <tr>
                <td>WeakMap</td>
                <td><code>199,211</code> ops/sec ±1.93% (82 runs sampled)</td>
            </tr>
            <tr>
                <td>WeakSet</td>
                <td><code>202,026</code> ops/sec ±1.91% (82 runs sampled)</td>
            </tr>
        </table>
    </section>

    <section class="slide">
        <h2 class="shout">Who notice any similarities&#x2049;&#xFE0F;</h2>
    </section>

    <section class="slide compact">
        <h2>Similarities</h2>

        <ul>
            <li><code>Map</code> &amp; <code>Set</code> can use primitives and objects as keys</li>
            <li><code>Set</code> &amp; <code>WeakSet</code> has unique keys</li>
            <li><code>WeakMap</code> &amp; <code>WeakSet</code> can use ONLY objects as keys</li>
            <li><code>WeakMap</code> &amp; <code>WeakSet</code> don't have <code>size</code> & <code>forEach</code> property</li>
            <li><code>WeakMap</code> &amp; <code>WeakSet</code> held items weakly, so GC will remove its when are unused</li>
        </ul>
    </section>

    <section class="slide prism">
        <h2>Differences</h2>
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
                // Symbol(Symbol.toStringTag)
                String(new Map) === "[object Map]"
                String(new Set) === "[object Set]"
                String(new WeakMap) === "[object WeakMap]"
                String(new WeakSet) === "[object WeakSet]"
            </code>
        </pre>
    </section>

    <section class="slide compact">
        <h2>Memory allocation: <mark>Array is lightweight</mark></h2>

        <table class="striped" style="font-size: 34px">
            <tr>
                <th>Type</th>
                <th>usedJSHeapSize</th>
            </tr>
            <tr>
                <td>Object</td>
                <td>7.977 KB</td>
            </tr>
            <tr>
                <td>Array</td>
                <td>5.281 KB</td>
            </tr>
            <tr>
                <td>Map</td>
                <td>28.625 KB</td>
            </tr>
            <tr>
                <td>Set</td>
                <td>13.219 KB</td>
            </tr>
            <tr>
                <td>WeakMap</td>
                <td>15.844 KB</td>
            </tr>
            <tr>
                <td>WeakSet</td>
                <td>9.484 KB</td>
            </tr>
        </table>
    </section>

    <section class="slide compact">
        <h2>Sources</h2>

        <ul>
            <li><a href="https://github.com/rwaldron/tc39-notes/">https://github.com/rwaldron/tc39-notes/</a></li>
            <li><a href="https://gist.github.com/ebidel/1b553d571f924da2da06">https://gist.github.com/ebidel/1b553d571f924da2da06</a></li>
            <li><a href="https://www.nczonline.net/newsletter/archive/4078df5df5/">https://www.nczonline.net/newsletter/archive/4078df5df5/</a></li>
            <li><a href="http://stackoverflow.com/questions/18808226/why-is-typeof-null-object">http://stackoverflow.com/questions/18808226/why-is-typeof-null-object</a></li>
            <li><a href="http://egorsmirnov.me/assets/berlin-angular-meetup-26/">http://egorsmirnov.me/assets/berlin-angular-meetup-26/</a></li>
            <li><a href="http://exploringjs.com/es6/ch_maps-sets.html">http://exploringjs.com/es6/ch_maps-sets.html</a></li>
            <li><a href="https://leanpub.com/understandinges6/read#leanpub-auto-sets-and-maps">https://leanpub.com/understandinges6/read#leanpub-auto-sets-and-maps</a></li>
            <li><a href="http://codepen.io/piecioshka/pen/pJWqOy">http://codepen.io/piecioshka/pen/pJWqOy</a></li>
        </ul>
    </section>

    <section class="slide compact">
        <h2>Sources (my projects)</h2>

        <ul>
            <li><a href="https://github.com/piecioshka/concept-assets-loader">https://github.com/piecioshka/concept-assets-loader</a></li>
            <li><a href="https://github.com/piecioshka/test-es2015-weakmap">https://github.com/piecioshka/test-es2015-weakmap</a></li>
            <li><a href="https://github.com/piecioshka/test-es2015-weakset">https://github.com/piecioshka/test-es2015-weakset</a></li>
            <li><a href="https://github.com/piecioshka/test-es2015-proxy">https://github.com/piecioshka/test-es2015-proxy</a></li>
            <li><a href="https://github.com/piecioshka/test-es6-map">https://github.com/piecioshka/test-es6-map</a></li>
            <li><a href="https://github.com/piecioshka/test-es6-map-foreach">https://github.com/piecioshka/test-es6-map-foreach</a></li>
            <li><a href="https://github.com/piecioshka/test-memory-heap">https://github.com/piecioshka/test-memory-heap</a></li>
            <li><a href="https://github.com/piecioshka/test-benchmark">https://github.com/piecioshka/test-benchmark</a></li>
        </ul>
    </section>

    <section class="slide prism">
        <h2 class="shout grow">Thanks &#x1F44F;<br/><span style="color: #999">Next meetup:</span><br/><mark style="font-size: 110px">12-10-2016</mark></h2>
    </section>

    <!--

    Tutaj będzie niespodzianka, bo mam jeszcze kilka slajdów dodatkowych o smaczkach w JavaScript.

    -->

    <section class="slide photo photo-6">
        <h2 class="shout">Hints</h2>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
                window.name = { foo: 1 }
                console.log(window.name) // [object Object]
                // what happen here?
                // [immutable type]

                const object = {};
                object.a = 1;
                console.log(object.a) // 1
                // why we can do this?
                // [immutable reference]
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
                typeof null === 'object' // true
                // why?
                // [empty reference to object]

                Number.isFinite('1.2') // false | ES6
                isFinite('1.2') // true | ES3
                // OMG
                // [more robust]

                typeof class {} === "function" // true
                // why?
                // [syntactic sugar]
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <h2>Angular2 fans?</h2>

        <pre style="font-size: 43px;" class="language-javascript line-numbers">
            <code>
                Object.observe(object, (changes) => {
                    console.log(changes);
                })

                // but today...
                Object.observe // undefined

                // what can I do? use Proxy!
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
                let object = {};
                object = new Proxy(object, {
                    set: (o, prop, value) => {
                        console.warn(`${prop} is set to ${value}`);
                        o[prop] = value;
                    },
                    get: (o, prop) => {
                        console.warn(`${prop} is read`);
                        return o[prop];
                    }
                })
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <h2 class="shout grow">Thanks &#x1F44F;<br/><span style="color: #999; font-size: 110px;">Do you remember when will be next meetup&#x2049;&#xFE0F;</span></h2>
    </section>

    <div class="progress"></div>

    <footer class="badge">
        <a href="https://github.com/piecioshka/slides-map-set-weakmap-weakset">Fork me on GitHub</a>
    </footer>

    <footer class="badge badge-top-left">
        <a href="#" class="fullscreen">Fullscreen</a>
    </footer>

    <script src="https://npmcdn.com/shower-core/shower.min.js"></script>
    <script src="modules/fullscreen.js"></script>

    <!-- Prism.js -->
    <script src="vendors/prism/prism.js"></script>
    <script src="modules/custom-prism.js"></script>
</body>
</html>
