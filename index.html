<!DOCTYPE html>
<html lang="en">
<head>
    <title>Map, Set, WeakMap, WeakSet</title>

    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Shower Theme -->
    <link rel="stylesheet" href="https://npmcdn.com/shower-ribbon/styles/screen-16x10.css">
    <link rel="stylesheet" href="vendors/shower-warsawjs/styles/main.css"/>
    <link rel="stylesheet" href="modules/custom-shower.css">

    <!-- Prism.js -->
    <link rel="stylesheet" href="vendors/prism/prism.css">
    <link rel="stylesheet" href="modules/custom-prism.css">

    <!-- My own beautiful photos as backgrounds -->
    <link rel="stylesheet" href="modules/photos.css">
    <link rel="stylesheet" href="modules/overlay-bars.css">
    <link rel="stylesheet" href="modules/birthday.css">
    <link rel="stylesheet" href="modules/a-lot-stuff.css">
    <link rel="stylesheet" href="modules/fullscreen-picture.css">
</head>
<body class="shower list">
    <header class="caption">
        <h1>Map, Set, WeakMap, WeakSet</h1>
        <p>Piotr Kowalski @piecioshka</p>
    </header>

    <section class="slide birthday">
        <h2 class="shout grow">
            <span class="years">2</span>
            <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;birthday&#x1F382;</span>
        </h2>
    </section>

    <section class="slide front-page">
        <div class="logo">
            <!-- Logo WarsawJS -->
            <img src="pictures/logo/warsawjs-logo-light.png">
        </div>

        <div class="details">
            <!-- 1. Avatar -->
            <img src="pictures/me.jpg" alt="Speaker"/>

            <!-- 2. Speaker -->
            <h2>Piotr Kowalski</h2>

            <!-- 3. Presentation title -->
            <h2>
                <strong>"New collections in JS: Map, Set, WeakMap, WeakSet"</strong>
            </h2>

            <!-- 4. Presentation date -->
            <h2>2016-09-14</h2>

            <!-- 5. Contact the speaker -->
            <h2><a href="http://twitter.com/piecioshka">@piecioshka</a></h2>
        </div>

        <div class="next slides-short-url as-overlay">
            <a href="http://bit.ly/2crnPjJ">bit.ly/2crnPjJ</a>
        </div>
    </section>

    <section class="slide" itemscope itemtype="http://schema.org/Person">
        <div class="who-am-i">
            <h2>Who am I?</h2>
            <h3><mark>Piotr Kowalski</mark></h3>

            <h3 itemprop="jobTitle">Kierownik Działu Aplikacji Webowych</h3>

            <p itemscope itemtype="https://schema.org/Organization">
                <span itemprop="name">Cyfrowy Polsat</span>,
                <span itemprop="location">Warsaw</span>
            </p>

            <p>
                <span><a href="http://www.refsnesdata.no/certification/w3certified.asp?id=4931932">JavaScript Ninja</a>. Mac lover. Open source fan.</span>
                <span><a href="https://piecioshka.pl/blog/">Blogger</a>.</span><br/>
                <span>Organizer <a href="http://warsawjs.com/" itemprop="memberOf">WarsawJS</a>.</span>
                <span>Author of several libs in <a href="https://www.npmjs.com/~piecioshka">@npm</a></span>
            </p>

            <p class="note">"Kto chce szuka sposobu, kto nie chce szuka powodu."</p>
        </div>

        <div class="next twitter-username as-overlay">
            <a href="http://twitter.com/piecioshka">@piecioshka</a>
        </div>
    </section>

    <section class="slide">
        <h2 class="shout">What collections<br/>we have&#x2049;&#xFE0F;</h2>
    </section>

    <section class="slide compact a-lot-stuff">
        <h2>Ignore this list of native collections</h2>

        <p>
            SIMD:
            <code>
                Float32Array,
                Float64Array,
                Int8Array,
                Int16Array,
                Int32Array,
                Uint8Array,
                Uint8ClampedArray,
                Uint16Array,
                Uint32Array
            </code>
        </p>

        <p>
            DOM:
            <code>
                DOMStringList,
                DOMStringMap,
                DOMTokenList,
                HTMLCollection,
                HTMLAllCollection,
                HTMLFormControlsCollection,
                HTMLOptionsCollection,
                NodeList,
                RadioNodeList,
                SVGAnimatedLengthList,
                SVGAnimatedNumberList,
                SVGAnimatedTransformList,
                SVGLengthList,
                SVGNumberList,
                SVGPointList,
                SVGStringList,
                SVGTransformList
            </code>
        </p>

        <p>
            Misc:
            <code>
                ArrayBuffer
                AudioTrackList,
                CSSRuleList,
                ClientRectList,
                DataTransferItemList,
                FileList,
                MediaKeys,
                MediaList,
                MediaQueryList,
                MimeTypeArray,
                PluginArray,
                SourceBufferList,
                SpeechGrammarList,
                StylePropertyMap,
                StyleSheetList,
                TextTrackCueList,
                TextTrackList,
                TouchList,
                TrackDefaultList,
                VTTRegionList,
                VideoTrackList
            </code>
        </p>
    </section>

    <section class="slide photo photo-7">
        <h2 class="shout"><code>Object</code><br/>(well known)</h2>
    </section>

    <section class="slide photo photo-5">
        <h2 class="shout"><code>Array</code><br/>(well known)</h2>
    </section>

    <section class="slide photo photo-12">
        <h2 class="shout">&#x2728; <code>Map</code> &#x2728;</h2>
    </section>

    <section class="slide photo photo-9">
        <h2 class="shout">&#x2728; <code>Set</code> &#x2728;</h2>
    </section>

    <section class="slide photo photo-10">
        <h2 class="shout"><code>WeakMap</code> &#x2728;</h2>
    </section>

    <section class="slide photo photo-3">
        <h2 class="shout"><code>WeakSet</code> &#x2728;</h2>
    </section>

    <section class="slide compact">
        <h2>Desktop browsers support</h2>

        <table class="striped" style="font-size: 40px">
            <tr>
                <th scope="col" width="100">...</th>
                <th width="150">Map</th>
                <th width="150">Set</th>
                <th width="150">WeakMap</th>
                <th width="150">WeakSet</th>
            </tr>
            <tr>
                <th scope="row">Chrome</th>
                <td>38</td>
                <td>38</td>
                <td>36</td>
                <td>36</td>
            </tr>
            <tr>
                <th scope="row">Firefox</th>
                <td>13</td>
                <td>13</td>
                <td>6</td>
                <td>34</td>
            </tr>
            <tr>
                <th scope="row">IE</th>
                <td>11</td>
                <td>11</td>
                <td>11</td>
                <td><pre style="margin: 0"><mark class="important">x</mark></pre></td>
            </tr>
            <tr>
                <th scope="row">Opera</th>
                <td>25</td>
                <td>25</td>
                <td>23</td>
                <td>23</td>
            </tr>
            <tr>
                <th scope="row">Safari</th>
                <td>7.1</td>
                <td>7.1</td>
                <td>7.1</td>
                <td>9</td>
            </tr>
        </table>
    </section>

    <section class="slide compact">
        <h2>Benchmark: <mark>Fastest is Object</mark></h2>

        <table class="striped" style="font-size: 36px">
            <tr>
                <th>Type</th>
                <th>Operations / seconds</th>
            </tr>
            <tr>
                <td>Object</td>
                <td><code>2,590,044</code> ops/sec ±6.32% (72 runs sampled)</td>
            </tr>
            <tr>
                <td>Array</td>
                <td><code>675,882</code> ops/sec ±13.49% (65 runs sampled)</td>
            </tr>
            <tr>
                <td>Map</td>
                <td><code>152,399</code> ops/sec ±9.67% (63 runs sampled)</td>
            </tr>
            <tr>
                <td>Set</td>
                <td><code>184,469</code> ops/sec ±6.27% (78 runs sampled)</td>
            </tr>
            <tr>
                <td>WeakMap</td>
                <td><code>199,211</code> ops/sec ±1.93% (82 runs sampled)</td>
            </tr>
            <tr>
                <td>WeakSet</td>
                <td><code>202,026</code> ops/sec ±1.91% (82 runs sampled)</td>
            </tr>
        </table>
    </section>

    <section class="slide compact">
        <h2>Memory allocation: <mark>Lightweight is Array</mark></h2>

        <table class="striped" style="font-size: 34px">
            <tr>
                <th>Type</th>
                <th>totalJSHeapSize</th>
                <th>usedJSHeapSize</th>
                <th>jsHeapSizeLimit</th>
            </tr>
            <tr>
                <td>Object</td>
                <td>7.977 KB</td>
                <td>7.977 KB</td>
                <td>0B</td>
            </tr>
            <tr>
                <td>Array</td>
                <td>5.281 KB</td>
                <td>5.281 KB</td>
                <td>0B</td>
            </tr>
            <tr>
                <td>Map</td>
                <td>28.625 KB</td>
                <td>28.625 KB</td>
                <td>0B</td>
            </tr>
            <tr>
                <td>Set</td>
                <td>13.219 KB</td>
                <td>13.219 KB</td>
                <td>0B</td>
            </tr>
            <tr>
                <td>WeakMap</td>
                <td>15.844 KB</td>
                <td>15.844 KB</td>
                <td>0B</td>
            </tr>
            <tr>
                <td>WeakSet</td>
                <td>9.484 KB</td>
                <td>9.484 KB</td>
                <td>0B</td>
            </tr>
        </table>
    </section>

    <section class="slide">
        <h2 class="shout">Which collection is the best&#x2049;&#xFE0F;</h2>
    </section>

    <section class="slide">
        <h2 class="shout">No one.</h2>
    </section>

    <section class="slide photo photo-12">
        <h2 class="shout"><code>Map</code></h2>
        <p class="note">
            The Map object is a simple key/value map. Any value (both objects and primitive values) may be used as either a key or a value.
            <strong>MDN @ 2016</strong>
        </p>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
                // #1: API
                // --------------------------------------------------
                // Check collection length.
                // WARNING: Property `size` is a getter.
                map.size // instead of: array.length

                // Clear collection
                map.clear() // instead of: array.length = 0

                // Remove pair key/value
                map.delete(key) // instead of: array.splice(0, 1)
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
                // #2: API
                // --------------------------------------------------
                // Get value from key
                map.get(key) // instead of: object[key]

                // Check if key is used in collection
                map.has(key)

                // instead of:
                object.hasOwnProperty(key) // or: key in object
                array.indexOf(value) !== -1
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
                // #3: API
                // --------------------------------------------------
                // Add to collection
                map.set() // instead of: array.push(value)

                // WARNING: this approach is not valid
                map.set(key1, val1, key2, val2)

                // similar like this:
                array.push(val1, val2, val3...)
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
                // #4: API: Hashmap
                // --------------------------------------------------
                var map = new Map();

                map.set('foo', 'bar')

                map.size // 1

                map.get('foo') // 'bar'
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
                // #5: API: Magic
                // --------------------------------------------------
                // Get pair key/value form collection {MapIterator}
                map.entries() // similar to: Object.entries(object)

                // Get keys from collection {MapIterator}
                map.keys() // similar to: Object.keys(object)

                // Get values from collection {MapIterator}
                map.values() // similar to: Object.values(object)
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
                // #6: API: Simple iteration
                // --------------------------------------------------

                // Iteration through collection
                map.forEach((value, key) => /* ... */)
                // the same in arrays
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
                // #7: API: Casting
                // --------------------------------------------------

                // Cast to "string"
                String(new Map) === "[object Map]"
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
                // #8: API: CR.D?
                // --------------------------------------------------
                var map = new Map();
                map.set({}, 1) // Block access to value "1"
                map.size // 1
                // But let's try to get...
                map.get({}) // undefined
                // ...or maybe we can remove it?
                map.delete({}) // false
                map.size // 1
                // So, how you can remove this key/value?
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
                // #9: API: Remove value from collection
                // --------------------------------------------------

                // Clear whole collection helps...
                map.clear()

                // ...or remove in loop.
                for (var [key, value] of map.entries()) {
                    map.delete(key) // true
                }
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
                // #10: API
                // --------------------------------------------------
                var map = new Map()
                map.set({ a: 1 }, 'a')

                var map2 = new Map(map.entries())

                // Comparison of 2 maps will fail, just as arrays.
                (map === map2) // false

                // But I have hope :)
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
                // #11: API: WTF?
                // --------------------------------------------------
                var map = new Map()
                map.set() // Map { undefined => undefined }
                map.size // 1

                // In arrays
                var array = []
                array.push()
                array.length // 0
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
                // #12: API: "Holy" couple key/value
                // --------------------------------------------------
                var map = new Map();
                var rand = Math.random();

                map.set([1, 2, 3], Math.random())
                map.set([1, 2, 3], Math.random())
                map.set([1, 2, 3], rand)
                map.set([1, 2, 3], rand)

                map.size // 4
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
                // #13: API: .. but unique key!
                // --------------------------------------------------
                var map = new Map();
                var rand = Math.random();

                map.set('item', Math.random())
                map.set('item', Math.random())
                map.set('item', rand)
                map.set('item', rand)

                map.size // 1
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
                // #1: Example: Array as key
                // --------------------------------------------------
                var map = new Map()
                map.set(['win8', 'moz'], 'a')
                map.set(['xp', 'firefox'], 'b')

                function check(list, ...browsers) {
                    for (let [key, value] of list)
                        if (String(browsers) === String(key))
                            return value
                }
                check(map, 'xp', 'firefox') // 'b'
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 25px;" class="language-javascript line-numbers">
            <code>
                // #2: Example: Async iteration
                // --------------------------------------------------
                map.set({ foo: 1 }, 'a').set({ foo: 2 }, 'b')
                var iterator = map.values() // {MapIterator}
                var interval = setInterval(() => {
                    let item = iterator.next()
                    if (item.done) {
                        clearInterval(interval)
                        return
                    }
                    console.log(item.value) // 'a' => [ONE SECOND] => 'b'
                }, 1000)
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 25px;" class="language-javascript line-numbers">
            <code>
                // #3: Example: Subclassing of Map
                // --------------------------------------------------
                class MultiMap extends Map {
                    set(...args) {
                        args.map(([key, value]) => super.set(key, value));
                        return this;
                    }
                }
                var map = new MultiMap();
                map.set(['key', 'value'], ['key2', 'value2']);
                // Map {"key" => "value", "key2" => "value2"}
            </code>
        </pre>
    </section>

    <section class="slide">
        <h2 class="shout">So, why <code>Map</code> is cool&#x2049;&#xFE0F;</h2>
    </section>

    <section class="slide photo photo-9">
        <h2 class="shout"><code>Set</code></h2>
        <p class="note">
            The Set object lets you store unique values of any type, whether primitive values or object references.
            <strong>MDN @ 2016</strong>
        </p>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
                // #1: API: Ehh...
                // --------------------------------------------------

                new Set(1, 2, 3, 4)
                // TypeError: (var)[Symbol.iterator] is not a function
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
                // #2: API
                // --------------------------------------------------
                // Remove item from collection.
                // WARNING: Removing is by value, not index.
                var set = new Set([1, 2, 3, 4])
                set.delete(3) // true

                console.log(set) // Set {1, 2, 4}

                // or simply...
                set.clear() // ...and we have empty Set
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
                // #3: API: Magic
                // --------------------------------------------------
                // Get values from collection {SetIterator}
                set.entries()
                set.keys()
                set.values()

                // hmmm...
                // set.values() and set.keys() returns Iterator,
                // which will be working on the same data, but
                set.values() === set.keys() // false
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
                // #4: API
                // --------------------------------------------------
                // Get... but what exactly?
                set.get(key) // TypeError: set.get is not a function

                // Check if value is in collection
                set.has(value)

                // instead of:
                array.indexOf(value) !== -1
                array.includes(value) // ES2016 (a.ka. ES7) way
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
                // #5: API: Append
                // --------------------------------------------------
                // Add to collection
                set.set() // ??? undefined
                set.add() // instead of: array.push(value)

                // WARNING: this approach is not valid:
                set.add(val1, val2, val3...)

                // similar like this:
                array.push(val1, val2, val3...)
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
                // #6: API: Simple iteration
                // --------------------------------------------------
                var set = new Set([1, 1, 2])

                set.forEach((item) => {
                    console.log(item) // 1, 2
                })
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
                // #7: API: Casting
                // --------------------------------------------------

                // Cast to "string"
                String(new Set) === "[object Set]"
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px; line-height: 30px" class="language-javascript line-numbers">
            <code>
                // #1: Example: AssetsLoader: loadImage helper
                // --------------------------------------------------
                function loadImage(path /* string */) {
                    return new Promise((resolve, reject) => {
                        let image = new Image();
                        let on = image.addEventListener;

                        on('load', () => resolve(image));
                        on('error', () => reject(image));
                        image.src = path;
                    })
                }
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px; line-height: 30px" class="language-javascript line-numbers">
            <code>
                // #1: Example: AssetsLoader: test case
                // --------------------------------------------------
                var al = new AssetsLoader();
                al.addImage('../assets/images/plants.jpg');
                al.addImage('../assets/images/sky.jpg');
                al.loadImages()
                    .catch((error) => {
                        console.error(error);
                    })
                    .then((images) => {
                        console.info('Loaded successful', images);
                    });
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px; line-height: 30px" class="language-javascript line-numbers">
            <code>
                // #1: Example: AssetsLoader v1
                // --------------------------------------------------
                class AssetsLoader {
                    constructor() {
                        this._images = new Set();
                    }
                    addImage(path /* string */) {
                        return this._images.add(loadImage(path));
                    }
                    loadImages() {
                        return Promise.all(this._images);
                    }
                }
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px; line-height: 30px" class="language-javascript line-numbers">
            <code>
                // #2: Example: AssetsLoader v2: Subclassing Set
                // --------------------------------------------------
                class AssetsLoader {
                    constructor() {
                        this._images = new Images();
                    }
                    addImage(path /* string */) {
                        return this._images.add(path);
                    }
                    loadImages() {
                        return this._images.load();
                    }
                }
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px; line-height: 30px" class="language-javascript line-numbers">
            <code>
                // #2: Example: AssetsLoader v2: Subclassing Set
                // --------------------------------------------------
                class Images extends Set {
                    add(path) {
                        return super.add(loadImage(path));
                    }
                    load() {
                        return Promise.all(this.keys());
                    }
                }
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
                // #3: Example: Mass addition
                // --------------------------------------------------
                var set = new Set()
                var array = [1, 2, 3, 1, 3, 4, 5, 6, 6, 6, 6]

                array.forEach(set.add.bind(set))
                console.log(set) // [1, 2, 3, 4, 5, 6]

                // Without `bind` some error occur:
                //   TypeError: Method Set.prototype.add called
                //   on incompatible receiver undefined
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
                // #4: Example: Remove duplicated primitives (Array)
                // --------------------------------------------------
                var array = [1, 2, 3, 1, 3]

                // Constructor expect another collection
                [...new Set(array)] // [1, 2, 3]
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
                // #4: Example: Remove duplicated primitives (Map)
                // --------------------------------------------------
                var map = new Map()
                map.set({ foo: 1 }, 'a')
                map.set({ foo: 2 }, 'b')

                [...new Set(map.keys())] // [{ foo: 1 }, { foo: 2 }]
                [...new Set(map.values())] // ['a', 'b']
            </code>
        </pre>
    </section>

    <section class="slide">
        <h2 class="shout">So, why <code>Set</code> is cool&#x2049;&#xFE0F;</h2>
    </section>

    <section class="slide photo photo-10">
        <h2 class="shout"><code>WeakMap</code></h2>
        <p class="note">
            The WeakMap object is a collection of key/value pairs in which the keys are weakly referenced. The keys must be objects and the values can be arbitrary values.
            <strong>MDN @ 2016</strong>
        </p>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
                // #1: API: Errors
                // --------------------------------------------------
                new WeakMap(1)
                // TypeError: (var)[Symbol.iterator] is not a function

                new WeakMap([1]) // ... or ....
                new WeakMap(new Set([1]))
                // TypeError: Iterator value 1 is not an entry object

                new WeakMap(new Set([1]).entries())
                // TypeError: Invalid value used as weak map key
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
                // #2: API: Simple API
                // --------------------------------------------------
                var weakMap = new WeakMap()
                var key = { foo: 1 }

                weakMap.set(1, 4) // TypeError: Invalid value used as weak map key
                weakMap.set([1], 5) // WeakMap { [1] => 5 }
                weakMap.set(key, 6) // WeakMap { [1] => 5, {foo: 1} => 6 }

                weakMap.get([1, 2, 3]) // undefined
                weakMap.get(key) // 6
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
                // #2: API: Simple API vol. 2
                // --------------------------------------------------
                // ....

                weakMap.has([1]) // false
                weakMap.has(key) // true

                weakMap.delete([1]) // false
                weakMap.delete(key) // true

                // no further methods and properties...
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
                // #3: API: Casting
                // --------------------------------------------------

                // Cast to "string"
                String(new WeakMap) === "[object WeakMap]"
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
                // #4: API: "Holy" couple key/value
                // --------------------------------------------------
                var weakMap = new WeakMap()

                weakMap.set([1, 2], Math.random())
                weakMap.set([1, 2], Math.random())
                weakMap.set([1, 2], Math.random())

                weakMap.size // ??? undefined

                weakMap // WeakMap {[1, 2] => 0.609..., [1, 2] => 0.268..., [1, 2] => 0.183...}
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
                // #5: API: How it works?
                // --------------------------------------------------
                var users = [{ name: 'Peter' }, { name: 'Kate' }];
                var weakMap = new WeakMap();

                weakMap.set(users[0], 'some info 1');
                weakMap.set(users[1], 'some info 2');

                console.log(weakMap.get(users[0])); // 'some info 1'
                users.splice(0, 1);
                console.log(weakMap.get(users[0])); // 'some info 2'
            </code>
        </pre>
    </section>

    <section class="slide">
        <img class="cover fullscreen-picture" src="pictures/weakmap/logs.png" alt="">
    </section>

    <section class="slide">
        <img class="cover fullscreen-picture" src="pictures/weakmap/gc-activate-log.png" alt="">
    </section>

    <section class="slide">
        <img class="cover fullscreen-picture" src="pictures/weakmap/gc-activate-timeline.png" alt="">
    </section>

    <section class="slide compact">
        <h2>More examples of using WeakMap</h2>

        <ul>
            <li>StackOverflow: Link DOM element with any attributes</li>
            <li>TC39 Branding: <a href="https://esdiscuss.org/topic/actual-weakset-use-cases">https://esdiscuss.org/topic/actual-weakset-use-cases</a></li>
            <li>Book ExploringJS: Cache: <a href="http://exploringjs.com/es6/ch_maps-sets.html#_caching-computed-results-via-weakmaps">http://exploringjs.com/es6/ch_maps-sets.html#_caching-computed-results-via-weakmaps</a></li>
            <li>Book ExploringJS: Observer pattern: <a href="http://exploringjs.com/es6/ch_maps-sets.html#_managing-listeners">http://exploringjs.com/es6/ch_maps-sets.html#_managing-listeners</a></li>
            <li>Book ExploringJS: Keep private data: <a href="http://exploringjs.com/es6/ch_maps-sets.html#_keeping-private-data-via-weakmaps">http://exploringjs.com/es6/ch_maps-sets.html#_keeping-private-data-via-weakmaps</a></li>
        </ul>
    </section>

    <section class="slide">
        <h2 class="shout">So, why <code>WeakMap</code> is cool&#x2049;&#xFE0F;</h2>
    </section>

    <section class="slide photo photo-3">
        <h2 class="shout"><code>WeakSet</code></h2>
        <p class="note">
            The WeakSet object lets you store weakly held objects in a collection. <strong>MDN @ 2016</strong>
        </p>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
                // #1: API: Problem with constructor
                // --------------------------------------------------

                new WeakSet([1, 2, 3]);
                // TypeError: Invalid value used in weak set

                new WeakSet(1, 2, 3);
                // TypeError: (var)[Symbol.iterator] is not a function
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
                // #2: API: Simple API
                // --------------------------------------------------
                // Adding ONLY objects
                weakSet.add([1])
                weakSet.add(1) // TypeError: Invalid value used in weak set

                // Checking by reference (not value)
                weakSet.has([1]) // false

                // Remove by reference too.
                weakSet.delete([1]) // false
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
                // #3: API: Cast
                // --------------------------------------------------

                // Cast to "string"
                String(new WeakSet) === '[object WeakSet]'
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 21px;" class="language-javascript line-numbers">
            <code>
                // #4: API: How it works?
                // --------------------------------------------------
                var users = [{ name: 'Peter' }, { name: 'Kate' }];
                var weakSet = new WeakSet();

                weakSet.add(users[0]);
                weakSet.add(users[1]);

                console.log(weakSet) // WeakSet {Object {name: "Kate"}, Object {name: "Peter"}}
                users.splice(0, 1);
                console.log(weakSet) // WeakSet {Object {name: "Kate"}, Object {name: "Peter"}}
            </code>
        </pre>
    </section>

    <section class="slide">
        <img class="cover fullscreen-picture" src="pictures/weakset/logs.png" alt="">
    </section>

    <section class="slide">
        <img class="cover fullscreen-picture" src="pictures/weakset/gc-activate-log.png" alt="">
    </section>

    <section class="slide">
        <img class="cover fullscreen-picture" src="pictures/weakset/gc-activate-timeline.png" alt="">
    </section>

    <section class="slide compact">
        <h2>More examples of using WeakMap</h2>

        <ul>
            <li>...</li>
        </ul>
    </section>

    <section class="slide">
        <h2 class="shout">So, why <code>WeakSet</code> is cool&#x2049;&#xFE0F;</h2>
    </section>

    <section class="slide compact">
        <h2>Sources</h2>

        <ul>
            <li><a href="https://github.com/rwaldron/tc39-notes/">https://github.com/rwaldron/tc39-notes/</a></li>
            <li><a href="http://exploringjs.com/es6/ch_maps-sets.html#sec_weakmap">http://exploringjs.com/es6/ch_maps-sets.html#sec_weakmap</a></li>
            <li><a href="https://gist.github.com/ebidel/1b553d571f924da2da06">https://gist.github.com/ebidel/1b553d571f924da2da06</a></li>
            <li><a href="https://www.nczonline.net/newsletter/archive/4078df5df5/">https://www.nczonline.net/newsletter/archive/4078df5df5/</a></li>
            <li><a href="http://stackoverflow.com/questions/18808226/why-is-typeof-null-object">http://stackoverflow.com/questions/18808226/why-is-typeof-null-object</a></li>
            <li><a href="http://egorsmirnov.me/assets/berlin-angular-meetup-26/">http://egorsmirnov.me/assets/berlin-angular-meetup-26/</a></li>
        </ul>
    </section>

    <section class="slide compact">
        <h2>Sources (my projects)</h2>

        <ul>
            <li><a href="https://github.com/piecioshka/concept-assets-loader">https://github.com/piecioshka/concept-assets-loader</a></li>
            <li><a href="https://github.com/piecioshka/test-es2015-weakmap">https://github.com/piecioshka/test-es2015-weakmap</a></li>
            <li><a href="https://github.com/piecioshka/test-es2015-weakset">https://github.com/piecioshka/test-es2015-weakset</a></li>
            <li><a href="https://github.com/piecioshka/test-es2015-proxy">https://github.com/piecioshka/test-es2015-proxy</a></li>
            <li><a href="https://github.com/piecioshka/test-es6-map">https://github.com/piecioshka/test-es6-map</a></li>
            <li><a href="https://github.com/piecioshka/test-es6-map-foreach">https://github.com/piecioshka/test-es6-map-foreach</a></li>
            <li><a href="https://github.com/piecioshka/test-memory-heap">https://github.com/piecioshka/test-memory-heap</a></li>
            <li><a href="https://github.com/piecioshka/test-benchmark">https://github.com/piecioshka/test-benchmark</a></li>
        </ul>
    </section>

    <section class="slide prism">
        <h2 class="shout grow">Thanks &#x1F44F;<br/><span style="color: #999">Next meetup:</span><br/><mark style="font-size: 110px">12-10-2016</mark></h2>
    </section>

    <!--

    Tutaj będzie niespodzianka, bo mam jeszcze kilka slajdów dodatkowych o smaczkach w JavaScript.

    -->

    <section class="slide photo photo-6">
        <h2 class="shout">Hints</h2>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
                window.name = { foo: 1 }
                console.log(window.name) // [object Object]
                // what happen here?
                // [immutable type]

                const object = {};
                object.a = 1;
                console.log(object.a) // 1
                // why we can do this?
                // [immutable reference]
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
                typeof null === 'object' // true
                // why?
                // [empty reference to object]

                Number.isFinite('1.2') // false
                isFinite('1.2') // true
                // OMG
                // [more robust]

                typeof class {} === "function" // true
                // why?
                // [syntactic sugar]
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <h2>Angular2 fans?</h2>

        <pre style="font-size: 45px;" class="language-javascript line-numbers">
            <code>
                Object.observe(object, (changes) => {
                    console.log(changes);
                })

                // but today...
                Object.observe // undefined

                // what can I do? use Proxy!
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
                let object = {};
                object = new Proxy(object, {
                    set: (o, prop, value) => {
                        console.warn(`${prop} is set to ${value}`);
                        o[prop] = value;
                    },
                    get: (o, prop) => {
                        console.warn(`${prop} is read`);
                        return o[prop];
                    }
                })
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 18px;" class="language-javascript line-numbers">
            <code>
            // TODO
            // - zgrupować podobne cechy i podstawowe różnice
            // - WeakSet
            //   - przykłady:
            //     - korzystając z przykładów podczas tworzenie definicji dla specyfikacji
            // Zwroty:
            //     - BEFORE: zbadać (będąc w PM) ile można ustawić padding na slajdzie "compact"
            //     - BEFORE: ustawić zegarek: http://marcin93.github.com/timer
            //     - BEFORE: ustawić alarm po 20 minutach
            //     - INFO: będę pokazywał na podstawie porównania do "object" oraz "array"
            //     - INFO: gdy poznawałem te kolekcje to nie czytałem spec, tylko testowałem w realu (potem oczywiście przeczytałem spec)
            //     - INFO: nie używam średników, aby zmniejszyć liczbę znaków
            //     - INFO: używam 'var' zamiast 'let' bo testowałem przykłady w DevTools > Sources > Snippets
            //     - za nim prezentacja to bardzo dziękuję, za tak liczne przybycie na nasze 2 urodziny
            //     - jeśli jesteście gdzieś gdzie jest ograniczona widoczność to zapraszam na link
            //     - może na początku się przedstawię
            //     -
            //     - kto z was na co dzień używa Map albo Set? i dlaczego?
            //     -
            //     - jesteście najlepszą publiczności przed jaką dzisiaj występowałem
            </code>
        </pre>
    </section>

    <div class="progress"></div>

    <footer class="badge">
        <a href="https://github.com/piecioshka/slides-map-set-weakmap-weakset">Fork me on GitHub</a>
    </footer>

    <footer class="badge badge-top-left">
        <a href="#" class="fullscreen">Fullscreen</a>
    </footer>

    <script src="https://npmcdn.com/shower-core/shower.min.js"></script>
    <script src="modules/fullscreen.js"></script>

    <!-- Prism.js -->
    <script src="vendors/prism/prism.js"></script>
    <script src="modules/custom-prism.js"></script>
</body>
</html>
