<!DOCTYPE html>
<html lang="en">
<head>
    <title>Map, Set, WeakMap, WeakSet</title>

    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Shower Theme -->
    <link rel="stylesheet" href="https://npmcdn.com/shower-ribbon/styles/screen-16x10.css">
    <link rel="stylesheet" href="vendors/shower-warsawjs/styles/main.css"/>
    <link rel="stylesheet" href="modules/custom-shower.css">

    <!-- Prism.js -->
    <link rel="stylesheet" href="vendors/prism/prism.css">
    <link rel="stylesheet" href="modules/custom-prism.css">

    <!-- My own beautiful photos as backgrounds -->
    <link rel="stylesheet" href="modules/photos.css">
    <link rel="stylesheet" href="modules/overlay-bars.css">
    <link rel="stylesheet" href="modules/birthday.css">
</head>
<body class="shower list">
    <header class="caption">
        <h1>Map, Set, WeakMap, WeakSet</h1>
        <p>Piotr Kowalski @piecioshka</p>
    </header>

    <section class="slide birthday">
        <h2 class="shout grow">
            <span class="years">2</span>
            <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;birthday&#x1F382;</span>
        </h2>
    </section>

    <section class="slide front-page">
        <div class="logo">
            <!-- Logo WarsawJS -->
            <img src="pictures/logo/warsawjs-logo-light.png">
        </div>

        <div class="details">
            <!-- 1. Avatar -->
            <img src="pictures/me.jpg" alt="Speaker"/>

            <!-- 2. Speaker -->
            <h2>Piotr Kowalski</h2>

            <!-- 3. Presentation title -->
            <h2>
                <strong>"New collections in JS: Map, Set, WeakMap, WeakSet"</strong>
            </h2>

            <!-- 4. Presentation date -->
            <h2>2016-09-14</h2>

            <!-- 5. Contact the speaker -->
            <h2><a href="http://twitter.com/piecioshka">@piecioshka</a></h2>
        </div>

        <div class="next slides-short-url as-overlay">
            <a href="http://bit.ly/2crnPjJ">bit.ly/2crnPjJ</a>
        </div>
    </section>

    <section class="slide" itemscope itemtype="http://schema.org/Person">
        <div class="who-am-i">
            <h2>Who am I?</h2>

            <h3 itemprop="jobTitle">Kierownik Działu Aplikacji Webowych</h3>

            <p itemscope itemtype="https://schema.org/Organization">
                <span itemprop="name">Cyfrowy Polsat</span>,
                <span itemprop="location">Warsaw</span>
            </p>

            <p>
                <span><a href="http://www.refsnesdata.no/certification/w3certified.asp?id=4931932">JavaScript Ninja</a>. Mac lover. Open source fan.</span>
                <span><a href="https://piecioshka.pl/blog/">Blogger</a>.</span><br/>
                <span>Organizer <a href="http://warsawjs.com/" itemprop="memberOf">WarsawJS</a>.</span>
                <span>Author of several libs in <a href="https://www.npmjs.com/~piecioshka">@npm</a></span>
            </p>

            <p class="note">"Kto chce szuka sposobu, kto nie chce szuka powodu."</p>
        </div>

        <div class="next twitter-username as-overlay">
            <a href="http://twitter.com/piecioshka">@piecioshka</a>
        </div>
    </section>

    <section class="slide">
        <h2 class="shout">What collections<br/>we have?</h2>
    </section>

    <section class="slide photo photo-7">
        <h2 class="shout"><code>Object</code><br/>(well known)</h2>
    </section>

    <section class="slide photo photo-5">
        <h2 class="shout"><code>Array</code><br/>(well known)</h2>
    </section>

    <section class="slide photo photo-12">
        <h2 class="shout">&#x2728; <code>Map</code> &#x2728;</h2>
    </section>

    <section class="slide photo photo-9">
        <h2 class="shout">&#x2728; <code>Set</code> &#x2728;</h2>
    </section>

    <section class="slide photo photo-10">
        <h2 class="shout"><code>WeakMap</code> &#x2728;</h2>
    </section>

    <section class="slide photo photo-3">
        <h2 class="shout"><code>WeakSet</code> &#x2728;</h2>
    </section>

    <section class="slide">
        <h2 class="shout">Which collection is the best?</h2>
    </section>

    <section class="slide photo photo-12">
        <h2 class="shout"><code>Map</code></h2>
        <p class="note">
            The Map object is a simple key/value map. Any value (both objects and primitive values) may be used as either a key or a value.
            <strong>MDN @ 2016</strong>
        </p>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
                // #1: Example: Array as key
                // ---------------------------------------------------------------------
                var map = new Map()
                map.set(['ie', 'moz'], 'a')
                map.set(['ie', 'moz', 'firefox'], 'b')

                function check(list, ...browsers) {
                    for (let [key, value] of list)
                        if (String(browsers) === String(key)) return value
                }
                check(map, 'ie', 'moz', 'firefox') // ???
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
            // #2: API
            // ---------------------------------------------------------------------
            // Check collection length.
            // WARNING: Property `size` is a getter.
            map.size // instead of: array.length

            // Clear collection
            map.clear() // instead of: array.length = 0

            // Remove pair key/value
            map.delete(key) // instead of: array.splice(0, 1)
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
            // #3: API
            // ---------------------------------------------------------------------
            // Get value from key
            map.get(key) // instead of: object[key]

            // Check, if key is used in collection
            map.has(key)

            // instead of:
            key in object
            array.indexOf(value) !== -1
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
                // #4: API
                // ---------------------------------------------------------------------
                // Add to collection
                map.set() // instead of: array.push(value)

                // WARNING: Unfortunately, that approach is not valid
                map.set(key1, val1, key2, val2) // similar like this: array.push(val1, val2, val3...)




            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
            // #5: API: Magic
            // ---------------------------------------------------------------------
            // Get pair key/value form collection {MapIterator}
            map.entries() // instead of: Object.entries(object) - ES2017 (a'ka ES8)

            // Get keys from collection {MapIterator}
            map.keys() // instead of: Object.keys(object)

            // Get values from collection {MapIterator}
            map.values() // instead of: Object.values(object) - ES2017 (a'ka ES8)

            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
            // #6: API: Simple iteration
            // ---------------------------------------------------------------------

            // Iteration through collection
            map.forEach((value, key) => /* ... */) // the same with arrays






            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
            // #7: API: Casting
            // ---------------------------------------------------------------------
            // Cast to "string"
            String(new Map) === "[object Map]"







            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
            // #8: API: CR.D?
            // ---------------------------------------------------------------------
            var map = new Map();
            map.set({}, 1) // Block access to value "1"
            map.size // 1

            // But let's try to get...
            map.get({}) // undefined

            // ...or maybe we can remove it?
            map.delete({}) // false
            map.size // 1

            // So, how can you remove that's key/value?
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
            // #9: API: Remove value from collection
            // ---------------------------------------------------------------------

            // Clear whole collection helps...
            map.clear()

            // ...or remove in loop.
            for (var [key, value] of map.entries()) {
                map.delete(key) // true
            }

            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
            // #10: Example: Async iteration
            // ---------------------------------------------------------------------
            map.set({ foo: 1 }, 'a')
            map.set({ foo: 2 }, 'b')

            var iterator = map.values() // {MapIterator}
            var interval = setInterval(() => {
                let item = iterator.next()
                if (item.done) {
                    clearInterval(interval)
                    return
                }
                console.log(item.value) // 'a' => [ONE SECOND] => 'b'
            }, 1000)
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
            // #11: API
            // ---------------------------------------------------------------------
            var map = new Map()
            map.set({ a: 1 }, 'a')

            var mo = new Map(map.entries())

            // Comparison of 2 maps will fail, just as arrays.
            (map === mo) // false

            // But I had hope :)
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
            // #12: API: WTF?
            // ---------------------------------------------------------------------
            var map = new Map()
            map.set() // Map { undefined => undefined }
            map.size // 1

            // In arrays
            var array = []
            array.push()
            array.length // 0

            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
            // #13: API: "Holy" couple key/value
            // ---------------------------------------------------------------------
            var map = new Map()

            map.set([1, 2, 3], Math.random())
            map.set([1, 2, 3], Math.random())
            map.set([1, 2, 3], Math.random())
            map.set([1, 2, 3], Math.random())

            map.size // 4

            </code>
        </pre>
    </section>

    <section class="slide">
        <h2 class="shout">So, why <code>Map</code> is cool?</h2>
    </section>

    <section class="slide photo photo-9">
        <h2 class="shout"><code>Set</code></h2>
        <p class="note">
            The Set object lets you store unique values of any type, whether primitive values or object references.
            <strong>MDN @ 2016</strong>
        </p>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
            // #1: Example: Mass addition
            // ---------------------------------------------------------------------
            var set = new Set()
            var array = [1, 2, 3, 1, 3, 4, 5, 6, 6, 6, 6]

            array.forEach(set.add.bind(set))
            console.log(set) // [1, 2, 3, 4, 5, 6]

            // Without `bind` some error occur:
            //   TypeError: Method Set.prototype.add called
            //   on incompatible receiver undefined
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
            // #2: Example: Remove duplicated primitives (or objects)
            // ---------------------------------------------------------------------
            var array = [1, 2, 3, 1, 3]

            // Constructor expect another collection
            [...new Set(array)] // [1, 2, 3]

            // -----------------------------------

            var map = new Map()
            map.set({ foo: 1 }, 'a')
            map.set({ foo: 2 }, 'b')

            [...new Set(map.keys())] // [{ foo: 1 }, { foo: 2 }]
            [...new Set(map.values())] // ['a', 'b']
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
            // #3: API: Ehh...
            // ---------------------------------------------------------------------

            new Set(1, 2, 3, 4)
            // TypeError: (var)[Symbol.iterator] is not a function






            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
            // #4: API
            // ---------------------------------------------------------------------
            // Remove item from collection.
            // WARNING: Remove is done by value, not index.
            var set = new Set([1, 2, 3, 4])
            set.delete(3) // true

            console.log(set) // Set {1, 2, 4}

            // or simply...
            set.clear() // ...and we have empty Set
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
            // #5: API: Magic
            // ---------------------------------------------------------------------
            // Get values from collection {SetIterator}
            set.entries() // instead of: Object.entries(object) - ES2017 (a'ka ES8)

            // Get values from collection {SetIterator}
            set.keys() // instead of: Object.keys(object)

            // Get values from collection {SetIterator}
            set.values() // instead of: Object.values(object) - ES2017 (a'ka ES8)

            // hmmm...
            // set.values() and set.keys() returns Iterator,
            // which will be working on the same data, but

            set.values() === set.keys() // false
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
            // #6: API
            // ---------------------------------------------------------------------
            // Get... but what exactly?
            set.get(key) // TypeError: set.get is not a function

            // Check, if value is in collection
            set.has(value)

            // instead of:
            array.includes(value)
            array.indexOf(value) !== -1
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
            // #7: API
            // ---------------------------------------------------------------------
            // Add to collection
            set.add() // instead of: array.push(value)

            // WARNING: Unfortunately that approach is not valid:
            set.add(val1, val2, val3...)

            // similar like this:
            array.push(val1, val2, val3...)

            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
            // #8: API: Simple iteration
            // ---------------------------------------------------------------------
            var set = new Set([1, 1, 2])

            set.forEach((i) => {
                console.log(i) // 1, 2
            })




            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
            // #10: API: Casting
            // ---------------------------------------------------------------------

            // Cast to "string"
            String(new Set) === "[object Set]"






            </code>
        </pre>
    </section>

    <section class="slide">
        <h2 class="shout">So, why <code>Set</code> is cool?</h2>
    </section>

    <section class="slide photo photo-10">
        <h2 class="shout"><code>WeakMap</code></h2>
        <p class="note">
            The WeakMap object is a collection of key/value pairs in which the keys are weakly referenced. The keys must be objects and the values can be arbitrary values.
            <strong>MDN @ 2016</strong>
        </p>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
            // #1: API: Simple API
            // ---------------------------------------------------------------------
            var weakMap = new WeakMap()
            var key = { foo: 1 }

            weakMap.set(1, 4) // TypeError: Invalid value used as weak map key
            weakMap.set([1], 5) // WeakMap { [1] => 5 }
            weakMap.set(key, 6) // WeakMap { [1] => 5, {foo: 1} => 6 }

            weakMap.get([1, 2, 3]) // undefined
            weakMap.get(key) // 6

            weakMap.has([1]) // false
            weakMap.has(key) // true

            weakMap.delete([1]) // false
            weakMap.delete(key) // true

            // no further methods...
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
            // #2: API: Casting
            // ---------------------------------------------------------------------

            // Cast to "string"
            String(new WeakMap) === "[object WeakMap]"






            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
            // #3: API: Errors
            // ---------------------------------------------------------------------
            new WeakMap(1)
            // TypeError: (var)[Symbol.iterator] is not a function

            new WeakMap([1])
            new WeakMap(new Set([1]))
            // TypeError: Iterator value 1 is not an entry object

            new WeakMap(new Set([1]).entries())
            // TypeError: Invalid value used as weak map key
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
            // #4: API: "Holy" couple key/value
            // ---------------------------------------------------------------------
            var weakMap = new WeakMap()

            weakMap.set([1, 2, 3], Math.random())
            weakMap.set([1, 2, 3], Math.random()) // ehh...
            weakMap.set([1, 2, 3], Math.random()) // ehh...




            </code>
        </pre>
    </section>

    <section class="slide">
        <h2 class="shout">So, why <code>WeakMap</code> is cool?</h2>
    </section>

    <section class="slide photo photo-3">
        <h2 class="shout"><code>WeakSet</code></h2>
        <p class="note">
            The WeakSet object lets you store weakly held objects in a collection. <strong>MDN @ 2016</strong>
        </p>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
            // #1: API: Problem with constructor
            // ---------------------------------------------------------------------

            new WeakSet([1, 2, 3]);
            // TypeError: Invalid value used in weak set

            new WeakSet(1, 2, 3);
            // TypeError: (var)[Symbol.iterator] is not a function




            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
            // #2: API: Simple API
            // ---------------------------------------------------------------------
            // Adding only objects (Array, Function, RegExp, Object)
            weakSet.add(1) // TypeError: Invalid value used in weak set
            weakSet.add([1]) // WeakSet {[1]}

            // Checking by reference (not value)
            weakSet.has([1]) // false

            // Remove by reference too.
            weakSet.delete([1]) // false
            console.log(weakSet) // WeakSet {[1]}
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
            // #3: API: Cast
            // ---------------------------------------------------------------------

            // Cast to "string"
            String(new WeakSet) === '[object WeakSet]'







            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
            // #4: Example: Remove duplicated objects (ONLY)
            // ---------------------------------------------------------------------
            var o = { foo: 1 }
            var advanced = [ o, { foo: 2 }, { foo: 3 }, o ];

            [...new Set(advanced)] // Array[3]
            [...new WeakSet(advanced)]
            // TypeError: (intermediate value)[Symbol.iterator] is not a function

            var weakSet = new WeakSet();
            advanced.forEach(weakSet.add.bind(weakSet))
            // WeakSet {Object {foo: 1}, Object {foo: 2}, Object {foo: 3}}
            // ...but Set is ensure that
            </code>
        </pre>
    </section>

    <section class="slide">
        <h2 class="shout">So, why <code>WeakSet</code> is cool?</h2>
    </section>

    <section class="slide photo photo-6">
        <h2 class="shout">Hints</h2>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
                window.name = { foo: 1 }
                console.log(window.name) // => [object Object]
                // what happen here?
                // [immutable type]

                const object = {};
                object.a = 1;
                console.log(object.a) // => 1
                // why we can do that?
                // [immutable reference]
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
                typeof null === 'object' // => true
                // why?
                // [empty reference to object]

                Number.isFinite('1.2') // => false
                isFinite('1.2') // => true
                // OMG
                // [more robust]

                typeof class {} === "function" // true
                // why?
                // [syntactic sugar]
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <h2>Angular2 fans?</h2>

        <pre style="font-size: 45px;" class="language-javascript line-numbers">
            <code>
            Object.observe // => undefined
            // but Proxy helps
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
                let object = {};
                object = new Proxy(object, {
                    set: (o, prop, value) => {
                        console.warn(`${prop} is set to ${value}`);
                        o[prop] = value;
                    },
                    get: (o, prop) => {
                        console.warn(`${prop} is read`);
                        return o[prop];
                    }
                })
            </code>
        </pre>
    </section>

    <section class="slide">
        <h2>Sources</h2>

        <ul>
            <li><a href="https://github.com/piecioshka/test-es2015-proxy">https://github.com/piecioshka/test-es2015-proxy</a></li>
            <li><a href="https://gist.github.com/ebidel/1b553d571f924da2da06">https://gist.github.com/ebidel/1b553d571f924da2da06</a></li>
            <li><a href="https://www.nczonline.net/newsletter/archive/4078df5df5/">https://www.nczonline.net/newsletter/archive/4078df5df5/</a></li>
            <li><a href="http://stackoverflow.com/questions/18808226/why-is-typeof-null-object">http://stackoverflow.com/questions/18808226/why-is-typeof-null-object</a></li>
        </ul>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
            // TODO
            // - stworzyć historię
            // - weryfikacja pamięci (ile zajmują dane) przy takich samych danych w różnych kolekcjach
            // - przebadać WeakMap oraz WeakSet pod kątem Memory Leak (prawdopodobnie klucze są usuwane przez GC)
            // - benchmarking? https://github.com/bestiejs/benchmark.js
            // - dodać przykłady wykorzystania WeakSet i WeakMap (korzystając from przykładów podczas tworzenie definicji dla specyfikacji)
            // - subclassing of Map, Set
            // - przerobić tak, aby nie skrolować slajdów do dołu
            // - dodać info o wsparciu w przeglądarkach
            // - dodać przykład obrazków w landing page-u (poco tablica do tworzenia Seta?)
            // - zgrupować podobne cechy i podstawowe różnice
            // WeakSet: cache, observer pattern (WeakReferences)
            // Zwroty:
            //     - kto z was na co dzień używa Map albo Set? i dlaczego?
            //     - jesteście najlepszą publiczności przed jaką dzisiaj występowałem
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <h2 class="shout grow">Thanks!<br/>Next meetup:<br/><mark style="font-size: 110px">12-10-2016</mark></h2>
    </section>

    <div class="progress"></div>

    <footer class="badge">
        <a href="https://github.com/piecioshka/slides-map-set-weakmap-weakset">Fork me on GitHub</a>
    </footer>

    <footer class="badge badge-top-left">
        <a href="#" class="fullscreen">Fullscreen</a>
    </footer>

    <script src="https://npmcdn.com/shower-core/shower.min.js"></script>
    <script src="modules/fullscreen.js"></script>

    <!-- Prism.js -->
    <script src="vendors/prism/prism.js"></script>
    <script src="modules/custom-prism.js"></script>
</body>
</html>
